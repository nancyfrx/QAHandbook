<font style="color:rgba(0, 0, 0, 0.4);background-color:rgb(252, 252, 252);">å½“ç³»ç»Ÿå¹¶å‘é‡çªç ´10ä¸‡çº§æ—¶ï¼Œçº¿ç¨‹è°ƒåº¦å’Œé”ç«äº‰å¼€é”€å¯å æ®90%çš„å¤„ç†æ—¶é—´ã€‚æœ¬æ–‡å°†æ­ç¤ºå¹¶å‘æ¶æ„å±‚çš„æ ¸å¿ƒç“¶é¢ˆåŠå…¶ç ´è§£ä¹‹é“ï¼ŒåŠ©åŠ›ç³»ç»Ÿå®ç°ä»"ä¸‡äººæ‹¥å µ"åˆ°"ç™¾ä¸‡äººå¹¶è¡Œ"çš„é£è·ƒã€‚</font>

## <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ä¸€ã€å¹¶å‘ç“¶é¢ˆçš„å››é‡é™·é˜±</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020015969-081b587a-a655-47db-a38c-459b4e581405.png)

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">å¹¶å‘ç“¶é¢ˆç‰¹å¾çŸ©é˜µ</font>
| **<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ç“¶é¢ˆç±»å‹</font>** | **<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">å…¸å‹è¡¨ç°</font>** | **<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">æ£€æµ‹æŒ‡æ ‡</font>** | **<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">è¯Šæ–­å·¥å…·</font>** |
| :---: | :---: | :---: | :---: |
| <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">çº¿ç¨‹é˜»å¡</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">çº¿ç¨‹WAITINGçŠ¶æ€>30%</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">`jstack</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">grep java.lang.Thread.State`</font> |
| <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">é”ç«äº‰</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">é”ç­‰å¾…æ—¶é—´>æ“ä½œæ—¶é—´</font> | `<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">jstack -l <pid></font>` | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">pprof mutex profiler</font> |
| <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ä¸Šä¸‹æ–‡åˆ‡æ¢</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">CS>10000/ç§’/æ ¸</font> | `<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">pidstat -w -p <pid> 1</font>` | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">perf schedåˆ†æ</font> |
| <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">èµ„æºç«äº‰</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">çº¿ç¨‹é¥¥é¥¿</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">èµ„æºè¯·æ±‚è¶…æ—¶ç‡>5%</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">çº¿ç¨‹æ± ç›‘æ§</font> |


## <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">äºŒã€å¹¶å‘æ¶æ„ä¼˜åŒ–çŸ©é˜µ</font>
### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">1. çº¿ç¨‹æ¨¡å‹æ¼”è¿›ä¹‹è·¯</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020189534-6be8acb4-6a4b-4c73-a3ad-d8aa3e870f48.png)

<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">2. å¹¶å‘æ¶æ„é€‰æ‹©å†³ç­–æ ‘</font>

![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020199780-b8a82e84-fc76-4f55-a72d-e79e077d0cf2.png)

## <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ä¸‰ã€çº¿ç¨‹æ± è°ƒä¼˜å®æˆ˜</font>
### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°æ¨¡å‹</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020252124-0d6fbcff-551d-4b71-9cb9-31fb01299876.png)

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">çº¿ç¨‹æ± é…ç½®é»„é‡‘æ³•åˆ™</font>
```plain
// IOå¯†é›†å‹æœåŠ¡ä¼˜åŒ–é…ç½®
ExecutorService ioExecutor = new ThreadPoolExecutor(
    Runtime.getRuntime().availableProcessors() * 2, // æ ¸å¿ƒçº¿ç¨‹æ•°
    Runtime.getRuntime().availableProcessors() * 8, // æœ€å¤§çº¿ç¨‹æ•°
    30, TimeUnit.SECONDS, // ç©ºé—²å›æ”¶æ—¶é—´
    new ArrayBlockingQueue<>(1000), // æœ‰ç•Œé˜Ÿåˆ—
    new ThreadPoolExecutor.CallerRunsPolicy() // é™çº§ç­–ç•¥
);

// è®¡ç®—å…¬å¼
æœ€ä½³æœ€å¤§çº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° * ç›®æ ‡CPUåˆ©ç”¨ç‡ * (1 + ç­‰å¾…æ—¶é—´/è®¡ç®—æ—¶é—´)
```

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">çº¿ç¨‹æ± ç›‘æ§å…³é”®æŒ‡æ ‡</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020375638-830a0a85-de00-48ea-927e-1cf75b7d24db.png)

## <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">å››ã€é”ç«äº‰ä¼˜åŒ–è‰ºæœ¯</font>
### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">é”æ€§èƒ½å¯¹æ¯”çŸ©é˜µ</font>
| **<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">é”ç±»å‹</font>** | **<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">é€‚ç”¨åœºæ™¯</font>** | **<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ååé‡</font>** | **<font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ä¼˜ç¼ºç‚¹</font>** |
| :---: | :---: | :---: | :---: |
| <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">synchronized</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ç®€å•ä¸´ç•ŒåŒº</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">10ä¸‡ops/s</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ç®€å•ä½†ä¼¸ç¼©æ€§å·®</font> |
| <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ReentrantLock</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ç«äº‰æ¿€çƒˆåœºæ™¯</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">85ä¸‡ops/s</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">æ”¯æŒå…¬å¹³é”/æ¡ä»¶å˜é‡</font> |
| <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">StampedLock</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">è¯»å¤šå†™å°‘</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">120ä¸‡ops/s</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ä¹è§‚è¯»å¤§å¹…æå‡è¯»æ€§èƒ½</font> |
| <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">æ— é”æ•°æ®ç»“æ„</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">é«˜ç«äº‰åœºæ™¯</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">300ä¸‡ops/s</font> | <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">å®ç°å¤æ‚ä½†æ€§èƒ½æè‡´</font> |


### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">è¯»å†™é”ä¼˜åŒ–æ¡ˆä¾‹</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020750402-1cd1ba04-d978-46ac-adfb-6993d053155a.png)

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">æ— é”é˜Ÿåˆ—å®ç°åŸç†</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020781392-e8e76c22-d743-44dd-bda7-d31f42eb7fb2.png)

## <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">äº”ã€å¼‚æ­¥éé˜»å¡æ¶æ„</font>
### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">Reactoræ¨¡å¼æ ¸å¿ƒåŸç†</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020801782-18c0dd0d-ced5-46a4-b80a-2acef30150b5.png)

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">Javaè™šæ‹Ÿçº¿ç¨‹å®æˆ˜</font>
```plain
try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
    List<Future<Integer>> futures = new ArrayList<>();
    for (int i = 0; i < 10_000; i++) {
        futures.add(executor.submit(() -> {
            // é˜»å¡æ“ä½œä¸ä¼šå ç”¨OSçº¿ç¨‹
            Thread.sleep(Duration.ofSeconds(1));
            return i;
        }));
    }
    
    for (Future<Integer> future : futures) {
        Integer result = future.get();
        // å¤„ç†ç»“æœ
    }
}
```

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">å¼‚æ­¥ä¼˜åŒ–æ•ˆæœå¯¹æ¯”</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751020971243-dadd1a75-0e8b-43e4-b0c5-55f34e667cce.png)

## <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">å…­ã€çœŸå®æ¡ˆä¾‹ï¼šç”µå•†åº“å­˜æœåŠ¡ä¼˜åŒ–</font>
### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">åŸå§‹æ¶æ„ç“¶é¢ˆ</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751021002110-c424c96d-bcc0-4022-ad6a-7e604edd1fcb.png)

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751021023046-cd27c47c-9a69-4b6e-9cd6-d5bf08948519.png)

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">åˆ†æ¡¶è®¾è®¡åŸç†</font>
```plain
// åº“å­˜æ¡¶åˆ†å‰²
public class InventoryBucket {
    private final int bucketCount = 32; // æ¡¶æ•°é‡
    private final QueueBucket[] buckets;
    
    public InventoryBucket() {
        buckets = new QueueBucket[bucketCount];
        for (int i = 0; i < bucketCount; i++) {
            buckets[i] = new QueueBucket();
        }
    }
    
    public void reduceStock(long itemId, int count) {
        int bucketIndex = (int) (itemId % bucketCount);
        buckets[bucketIndex].submit(itemId, count);
    }
}

// å•æ¡¶å¤„ç†çº¿ç¨‹
class QueueBucket implements Runnable {
    private final ConcurrentLinkedQueue<Order> queue = new ConcurrentLinkedQueue<>();
    
    public void submit(long itemId, int count) {
        queue.offer(new Order(itemId, count));
    }
    
    public void run() {
        while (!Thread.interrupted()) {
            Order order = queue.poll();
            if (order != null) {
                // æ— é”å¤„ç†
                inventoryMap.compute(order.itemId, (k, v) -> v - order.count);
            }
        }
    }
}
```



## <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">ä¸ƒã€æœªæ¥å¹¶å‘æ¶æ„è¶‹åŠ¿</font>
### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">1. å¼‚æ­¥æ— æ ˆåç¨‹</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751021202040-c410c987-fb81-4af5-b451-943ef46d71e1.png)

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">2. è‡ªåŠ¨å¹¶å‘åº¦è°ƒèŠ‚</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751021214089-9a4dffdf-3592-4139-b6a6-df28ab60bd7b.png)

### <font style="color:rgba(0, 0, 0, 0.9);background-color:rgb(252, 252, 252);">3. åˆ†å¸ƒå¼æ— é”æ¶æ„</font>
![](https://cdn.nlark.com/yuque/0/2025/png/538409/1751021245712-ff0d2ef6-6618-4a35-a1ee-64d67d9eb87f.png)

**<font style="background-color:rgb(252, 252, 252);"></font>**

**<font style="background-color:rgb(252, 252, 252);">æ¶æ„å¸ˆç®´è¨€</font>**<font style="background-color:rgb(252, 252, 252);">ï¼šçªç ´å¹¶å‘ç“¶é¢ˆçš„å…³é”®ä¸æ˜¯å¢åŠ æ›´å¤šçº¿ç¨‹ï¼Œè€Œæ˜¯å‡å°‘ä¾èµ–å’Œç­‰å¾…ã€‚æ ¸å¿ƒåŸåˆ™ï¼š  
</font><font style="background-color:rgb(252, 252, 252);">ğŸ”¸</font><font style="background-color:rgb(252, 252, 252);"> </font>**<font style="background-color:rgb(252, 252, 252);">è®¡ç®—é€»è¾‘çº¿æ€§åŒ–</font>**<font style="background-color:rgb(252, 252, 252);">ï¼šç¡®ä¿å•ä¸ªè®¡ç®—å•å…ƒå†…çš„æ“ä½œæ— é˜»å¡  
</font><font style="background-color:rgb(252, 252, 252);">ğŸ”¸</font><font style="background-color:rgb(252, 252, 252);"> </font>**<font style="background-color:rgb(252, 252, 252);">çŠ¶æ€éš”ç¦»</font>**<font style="background-color:rgb(252, 252, 252);">ï¼šé¿å…è·¨å•å…ƒçš„çŠ¶æ€å…±äº«  
</font><font style="background-color:rgb(252, 252, 252);">ğŸ”¸</font><font style="background-color:rgb(252, 252, 252);"> </font>**<font style="background-color:rgb(252, 252, 252);">å¼‚æ­¥æ¶ˆæ¯ä¼ é€’</font>**<font style="background-color:rgb(252, 252, 252);">ï¼šç”¨é€šä¿¡ä»£æ›¿å…±äº«å†…å­˜  
</font><font style="background-color:rgb(252, 252, 252);">ğŸ”¸</font><font style="background-color:rgb(252, 252, 252);"> </font>**<font style="background-color:rgb(252, 252, 252);">åˆ†ç‰‡å¹¶å‘</font>**<font style="background-color:rgb(252, 252, 252);">ï¼šå°†å…¨å±€ç«äº‰è½¬ä¸ºå±€éƒ¨å¹¶å‘</font>

<font style="background-color:rgb(252, 252, 252);">æŒæ¡è¿™äº›åŸåˆ™ï¼Œä½ çš„ç³»ç»Ÿå°†å®ç°ä»"æœ‰é™å¹¶å‘"åˆ°"æ— é™æ‰©å±•"çš„è´¨å˜ï¼</font>

